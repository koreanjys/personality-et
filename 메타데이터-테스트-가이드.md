# 🧪 메타데이터 테스트 가이드

브라우저 언어별 동적 메타데이터가 올바르게 작동하는지 확인하는 방법입니다.

## 🚀 사전 준비

1. **개발 서버 시작**
   ```bash
   npm run dev
   ```
   
2. **브라우저에서 접속**
   ```
   http://localhost:5174
   ```

## 🌐 테스트 방법

### 1️⃣ 한국어 클라이언트 테스트

#### Chrome 언어 설정 변경
1. Chrome 설정 (chrome://settings/) 접속
2. **고급** → **언어** 클릭
3. **한국어** 추가 및 **맨 위로 이동**
4. Chrome 재시작

#### 메타데이터 확인
1. `http://localhost:5174` 접속
2. **F12** → **Elements 탭** → `<head>` 영역 확인
3. **Console 탭**에서 다음 명령어 실행:

```javascript
// 브라우저 언어 확인
navigator.language

// 현재 메타데이터 확인 (페이지 로드 완료 후 1초 대기)
setTimeout(() => {
  console.log({
    언어: navigator.language,
    제목: document.title,
    설명: document.querySelector('meta[name="description"]').content,
    OG제목: document.querySelector('meta[property="og:title"]').content,
    OG언어: document.querySelector('meta[property="og:locale"]').content
  })
}, 1000);
```

#### 예상 결과 (한국어)
```
언어: "ko-KR" (또는 "ko")
제목: "무료 성격 테스트 | MBTI 성향 & 에겐테토 궁합 테스트"
설명: "무료 성격 테스트로 당신의 MBTI 성향을 알아보고 에겐-테토와의 궁합을 확인해보세요! 16가지 성격 유형별 상세 분석과 캐릭터 궁합도를 제공합니다."
OG언어: "ko_KR"
```

---

### 2️⃣ 영어 클라이언트 테스트

#### Chrome 언어 설정 변경
1. Chrome 설정 (chrome://settings/) 접속
2. **고급** → **언어** 클릭
3. **English (United States)** 추가 및 **맨 위로 이동**
4. **한국어 제거** 또는 **맨 아래로 이동** (중요!)
5. Chrome 완전 재시작 (`chrome://restart`)

#### ⚠️ 중요: localStorage 초기화 필수
영어 테스트 전에 반드시 localStorage를 초기화하세요:
```javascript
// localStorage 완전 초기화
localStorage.clear();
window.location.reload();

// 또는 언어 설정만 초기화
localStorage.removeItem('i18nextLng');
window.location.reload();
```

#### 메타데이터 확인
1. `http://localhost:5174` 접속 (**시크릿 모드 권장**)
2. **F12** → **Console 탭**에서 동일한 명령어 실행

#### 예상 결과 (영어)
```
언어: "en-US" (또는 "en")
제목: "Free Personality Test | MBTI & Egen-Teto Compatibility Test"
설명: "Discover your MBTI personality type and check your compatibility with Egen-Teto characters! Get detailed analysis of 16 personality types and character compatibility ratings."
OG언어: "en_US"
```

---

## 📊 결과 페이지 테스트

### 한국어 환경
```javascript
// 결과 페이지로 이동
window.location.href = "/?id=ENFJ-eigen"

// 메타데이터 다시 확인
console.log({
  제목: document.title,
  설명: document.querySelector('meta[name="description"]').content
})
```

**예상 결과:**
- 제목: `"ENFJ + 에겐 성격 유형 | 무료 MBTI 성향 테스트 결과"`
- 설명: 한국어로 된 성격 유형 설명 (예: "당신의 성격 유형은 ENFJ + 에겐입니다! 상세한 성격 분석과 에겐-테토와의 궁합을 확인해보세요.")

### 영어 환경
동일한 테스트 실행

**예상 결과:**
- 제목: `"ENFJ + Egen Personality Type | Free MBTI Test Results"`
- 설명: 영어로 된 성격 유형 설명 (예: "Your personality type is ENFJ + Egen! Discover detailed personality analysis and compatibility with Egen-Teto characters.")

---

## 🔗 공유 링크 테스트

### 테스트할 URL들
```
http://localhost:5174/?id=ENFJ-eigen
http://localhost:5174/?id=ISFP-teto
http://localhost:5174/?id=INTP-eigen
```

각 URL을 **한국어/영어 브라우저 환경**에서 접속하여 메타데이터 확인

---

## 📱 소셜 미디어 미리보기 테스트

### Facebook Sharing Debugger
1. https://developers.facebook.com/tools/debug/ 접속
2. `http://localhost:5173` 입력 후 **Debug** 클릭
3. **Open Graph** 정보 확인
4. 결과 페이지도 테스트: `http://localhost:5173/?id=ENFJ-eigen`

### Twitter Card Validator  
1. https://cards-dev.twitter.com/validator 접속
2. `http://localhost:5173` 입력 후 **Preview card** 클릭
3. Twitter Card 정보 확인
4. 결과 페이지도 테스트: `http://localhost:5173/?id=ENFJ-eigen`

---

## ✅ 검증 체크리스트

### 한국어 브라우저 (`ko-KR`)
- [ ] 홈페이지 제목: "무료 성격 테스트 | MBTI 성향 & 에겐테토 궁합 테스트"
- [ ] 홈페이지 설명에 "무료 성격 테스트로 당신의 MBTI 성향을 알아보고 에겐-테토와의 궁합을 확인해보세요!" 포함  
- [ ] `og:locale` = `"ko_KR"`
- [ ] 결과 페이지 제목: "성격 유형 | 무료 MBTI 성향 테스트 결과" 형식 (예: "ENFJ + 에겐 성격 유형 | 무료 MBTI 성향 테스트 결과")
- [ ] 결과 페이지에서 "에겐/테토" 한국어 표시
- [ ] 소셜 미디어 미리보기에서 한국어 제목/설명

### 영어 브라우저 (`en-US`)
- [ ] 홈페이지 제목: "Free Personality Test | MBTI & Egen-Teto Compatibility Test"
- [ ] 홈페이지 설명에 "Discover your MBTI personality type and check your compatibility with Egen-Teto characters!" 포함
- [ ] `og:locale` = `"en_US"`  
- [ ] 결과 페이지 제목: "Personality Type | Free MBTI Test Results" 형식 (예: "ENFJ + Egen Personality Type | Free MBTI Test Results")
- [ ] 결과 페이지에서 "Egen/Teto" 영어 표시
- [ ] 소셜 미디어 미리보기에서 영어 제목/설명

---

## 🛠️ 문제 해결

### 메타데이터가 변경되지 않는 경우
1. **하드 새로고침**: `Ctrl+Shift+R` (Windows) / `Cmd+Shift+R` (Mac)
2. **캐시 삭제**: 개발자도구 → Network 탭 → "Disable cache" 체크
3. **시크릿 모드**에서 테스트
4. **다른 브라우저**에서 테스트 (Firefox, Safari 등)
5. **JavaScript 로딩 대기**: 페이지 로드 후 1-2초 기다린 후 메타데이터 확인

### 언어 설정이 적용되지 않는 경우
1. **localStorage 초기화**: 개발자도구 → Application/Storage 탭 → Local Storage → 도메인 → `i18nextLng` 키 삭제
2. Chrome 완전 재시작
3. `chrome://restart` 접속하여 재시작
4. 다른 프로필/시크릿 모드에서 테스트
5. 브라우저 언어 설정 후 모든 탭 닫고 다시 열기

### 🚨 중요: localStorage vs 브라우저 언어 우선순위 문제
현재 사이트는 **localStorage에 저장된 언어가 브라우저 언어보다 우선적용**됩니다:
1. 한 번이라도 언어 전환기를 사용하면 localStorage에 언어가 저장됨
2. 이후 브라우저 언어를 변경해도 localStorage 설정이 우선 적용됨
3. **해결 방법**: 개발자도구에서 localStorage의 `i18nextLng` 키를 삭제하고 새로고침

### JavaScript 관련 주의사항
- 메타데이터는 JavaScript로 동적 생성되므로 **페이지 로드 완료 후 확인** 필수
- `DOMContentLoaded` 이벤트 후 메타데이터가 업데이트됨
- 콘솔에서 확인 시 `setTimeout(1000)` 사용하여 **1초 이상 지연** 후 확인 권장
- 결과 페이지는 추가 로딩 시간이 필요하므로 **2초 이상 대기** 후 확인
- 즉시 확인하면 기본값(한국어)이 표시될 수 있음

---

## 📋 빠른 테스트 스크립트

브라우저 콘솔에 복사/붙여넣기용:

```javascript
// 전체 메타데이터 상태 확인 (페이지 로드 후 충분한 시간 대기)
function checkMetadata() {
  const isKorean = navigator.language.toLowerCase().startsWith('ko');
  const savedLang = localStorage.getItem('i18nextLng');
  const data = {
    browserLang: navigator.language,
    savedLang: savedLang,
    expectedLang: isKorean ? '한국어' : '영어',
    actualLang: savedLang || (isKorean ? 'ko' : 'en'),
    title: document.title,
    description: document.querySelector('meta[name="description"]')?.content,
    ogTitle: document.querySelector('meta[property="og:title"]')?.content,
    ogLocale: document.querySelector('meta[property="og:locale"]')?.content,
    twitterTitle: document.querySelector('meta[name="twitter:title"]')?.content
  };
  
  console.log('🧪 메타데이터 테스트 결과:', data);
  
  // localStorage 우선순위 경고
  if (savedLang && savedLang !== (isKorean ? 'ko' : 'en')) {
    console.warn('⚠️ localStorage와 브라우저 언어가 다릅니다!');
    console.log(`브라우저 언어: ${navigator.language} (${isKorean ? '한국어' : '영어'})`);
    console.log(`저장된 언어: ${savedLang}`);
    console.log('💡 localStorage 초기화: localStorage.removeItem("i18nextLng")');
  }
  
  // 실제 적용된 언어 기준 검증
  const actualIsKorean = (savedLang || (isKorean ? 'ko' : 'en')) === 'ko';
  
  if (actualIsKorean) {
    const expectedTitle = '무료 성격 테스트 | MBTI 성향 & 에겐테토 궁합 테스트';
    const expectedDesc = '무료 성격 테스트로 당신의 MBTI 성향을 알아보고 에겐-테토와의 궁합을 확인해보세요!';
    const expectedLocale = 'ko_KR';
    
    console.log(data.title === expectedTitle ? '✅ 한국어 제목 정상' : '❌ 한국어 제목 오류');
    console.log(data.description && data.description.includes('무료 성격 테스트로 당신의 MBTI 성향을') ? '✅ 한국어 설명 정상' : '❌ 한국어 설명 오류');
    console.log(data.ogLocale === expectedLocale ? '✅ 한국어 Locale 정상' : '❌ 한국어 Locale 오류');
  } else {
    const expectedTitle = 'Free Personality Test | MBTI & Egen-Teto Compatibility Test';
    const expectedDesc = 'Discover your MBTI personality type and check your compatibility with Egen-Teto characters!';
    const expectedLocale = 'en_US';
    
    console.log(data.title === expectedTitle ? '✅ 영어 제목 정상' : '❌ 영어 제목 오류');
    console.log(data.description && data.description.includes('Discover your MBTI personality type and check your compatibility') ? '✅ 영어 설명 정상' : '❌ 영어 설명 오류');
    console.log(data.ogLocale === expectedLocale ? '✅ 영어 Locale 정상' : '❌ 영어 Locale 오류');
  }
  
  return data;
}

// localStorage 초기화 함수
function resetLanguageSettings() {
  localStorage.removeItem('i18nextLng');
  console.log('🔄 언어 설정 초기화 완료. 페이지를 새로고침하세요.');
  setTimeout(() => {
    window.location.reload();
  }, 1000);
}

// 실행 (페이지 로드 후 충분한 시간 대기)
setTimeout(() => {
  checkMetadata();
}, 1000);

// 결과 페이지 테스트 함수 추가
function testResultPage(personalityType = 'ENFJ-eigen') {
  window.location.href = `/?id=${personalityType}`;
  
  // 페이지 로드 및 JavaScript 실행을 위해 충분한 시간 대기
  setTimeout(() => {
    console.log('📊 결과 페이지 메타데이터:');
    checkMetadata();
  }, 2000); // 결과 페이지는 추가 로딩 시간 필요
}

// 사용법
console.log('💡 결과 페이지 테스트: testResultPage("ENFJ-eigen")');
console.log('💡 다른 결과 테스트: testResultPage("ISFP-teto")');
console.log('🔄 언어 설정 초기화: resetLanguageSettings()');
```

이 가이드대로 테스트하시면 브라우저 언어별 메타데이터가 올바르게 작동하는지 확인할 수 있습니다! 🚀
